```{r global_options, include=FALSE}
library(magrittr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(cowplot)
library(reshape)
```
##Plotting codons used in each strain

Here we go reading up all my tables and merging 'em together.  I haven't incorporated read() or the join function yet, but its faster cause smaller files:
```{r}
PB1 <- merge_all(list(read.csv(file='H2N2PB1.fa.tidy', head=TRUE, sep='\t'), 
                      read.csv(file='H1N1PB1.fa.tidy', head=TRUE, sep='\t'), 
                      read.csv(file='H3N2PB1.fa.tidy', head=TRUE, sep='\t')), 
                 all.x=TRUE, all.y=TRUE)
codonvalues <- read.csv(file='codonvalues', head=TRUE, sep='\t')
```

Now I gotta table with: strain, sero, year, coryear, codon, numcodon, numaa.  I also have another table holding a bunch of values associated with each codon.

Now I can plot!

__Number of each codon found in strain__
```{r}
ggplot(PB1, aes(x=coryear, y=(numcodon), color=sero))+geom_point()+ background_grid(major = "xy", minor = "none")+facet_wrap(~codon)
```


__Proportion of each codon used for its amino acid in strain__
```{r}
ggplot(PB1, aes(x=coryear, y=(numcodon/numaa), color=sero))+geom_point()+ background_grid(major = "xy", minor = "none")+facet_wrap(~codon)
```

__Pulling out linear regression__
```{r}
PB1 %>% group_by(sero, codon) %>% do(lm.result = lm((numcodon) ~ coryear, data=.)) -> fitted.models
intslope <- do(fitted.models, data.frame(sero=.$sero,codon=.$cod, 
                             intercept=coef(.$lm.result)[1], 
                             slope=coef(.$lm.result)[2]))
rm(fitted.models)
intslope
```

Nice!  slopes and intercetps GOT!
Next up: p values

```{r}
PB1 %>% group_by(sero, codon) %>%
  do(cor.res = cor.test(.$numcodon, .$coryear)) -> cors
corp <- do(cors, data.frame(sero=.$sero, codon=.$codon, cor=.$cor.res$estimate, p=.$cor.res$p.value))
rm(cors)
corp
```

I mostly just copy-pasted the stats stuff.  I think I understand them, but I'll have to mess around with them a bit more. NEways, now ima dump that into a table with CAI and rtAI:

``` {r}
codonstats <- select(corp, sero, codon, p) %>% 
  left_join(select(intslope, codon, sero, slope)) %>% 
  left_join(select(codonvalues, codon, withIFN, noIFN, CAI)) %>% 
  mutate(rtAI = withIFN/noIFN)
```

```{r}
ggplot(codonstats, aes(x=rtAI, y=slope, label=codon))+geom_point()+ background_grid(major = "xy", minor = "none")+geom_text(size = 5)+facet_wrap(~sero)
ggplot(codonstats, aes(x=CAI, y=slope, label=codon))+geom_point()+ background_grid(major = "xy", minor = "none")+geom_text(size = 5)+facet_wrap(~sero)
ggplot(codonstats, aes(x=rtAI, y=CAI, label=codon))+geom_point()+ background_grid(major = "xy", minor = "none")+geom_text(size = 5)+facet_wrap(~sero)
```